/*!
 * dform.js v0.4.5
 */
!function(o){var e=function(){};e.prototype.init=function(e,r){var t=this;t.options=r,t.$formCnt=e,t.$form=e.find("form"),t.$subBtn=e.find(".subBtn"),t.$errCnt=e.find(".errorMsg"),t.$sucCnt=e.find(".successMsg"),t.$subBtn.prop("disabled",!1),t.$form.find("input, textarea").each(function(e,r){""==o(this).val()&&o(this).val(o(this).attr("data-default")),o(this).focus(function(){o(this).val()==o(this).attr("data-default")&&o(this).val("")}),o(this).blur(function(){""==o(this).val()&&o(this).val(o(this).attr("data-default"))})}),t.$form.find("."+t.options.errorFieldMsgClass).hide(),t.$subBtn.click(function(e){e.preventDefault(),t.post(o(this))}),t.$form.submit(function(o){o.preventDefault(),t.post(t.$subBtn)})},e.prototype.debug=function(o){1==this.options.debug&&window.console&&console.log(o)},e.prototype.post=function(e){var r=this;o.isFunction(r.options.onBefore)&&r.options.onBefore.call(this),r.$errCnt.hide(),r.$sucCnt.hide(),r.$formCnt.find("."+r.options.errorFieldMsgClass).hide(),r.$subBtn.prop("disabled",!0),r.$form.find("input, textarea").each(function(){o(this).val()==o(this).attr("data-default")&&o(this).val("")}),r.debug("post"),r.$formCnt.bload(r.options.bloadOpts,function(t){r.debug("bload"),r.$formCnt.find('[name="submitted"]').val("yes");var s=r.$form.attr("action");""==s&&(s=document.URL);var a=r.$form.serializeArray();e&&e.attr("name")&&e.attr("value")&&a.push({name:e.attr("name"),value:e.attr("value")}),o.ajax({type:"POST",cache:!1,url:s,data:a,beforeSend:r.options.beforeSend,dataType:"json",success:function(e,t){return r.debug("success"),r.debug(e),o.isFunction(r.options.onComplete)?void r.options.onComplete.call(this,e):(e.modalType&&(r.options.modalType=e.modalType),r.options.errorClass!==!1&&r.$formCnt.find("."+r.options.errorClass).removeClass(r.options.errorClass),"error"==e.status?(r.debug("status error"),r.$form.find("input, textarea").each(function(){""==o(this).val()&&o(this).attr("data-default")&&o(this).val(o(this).attr("data-default"))}),r.handleError(e)):(r.debug("status success"),r.handleSuccess(e)),void 0)},error:function(o,e,t){r.debug("error")},complete:function(o,e){r.debug("complete"),t.hide(),r.$subBtn.prop("disabled",!1)}})})},e.prototype.addErrorClass=function(o){var e=this,r=e.$form.find('[name="'+o+'"]');switch(e.options.errorClassType){case"parent":r.closest(e.options.errorClassSelector).addClass(e.options.errorClass),e.debug("Add Err Class ["+e.options.errorClass+"] to parent div of ["+o+"]");break;case"input":r.addClass(e.options.errorClass),e.debug("Add Err Class ["+e.options.errorClass+"] to input ["+o+"]")}},e.prototype.handleError=function(e){var r=this;if(o.isFunction(r.options.onError)&&r.options.onError.call(this,e),r.options.fullErrorType!==!1){var t=e.msg?e.msg:r.$errCnt.html(),s=e.fullErrorType?e.fullErrorType:r.options.fullErrorType;switch(s){case"modal":r.modalMessage({message:t,type:"error"});break;case"show":r.$errCnt.html(t).show()}}if(e.errFlds&&e.errFlds.length>0)for(l=0;l<e.errFlds.length;l++)e.errMsgs&&e.errMsgs[e.errFlds[l]]&&r.$formCnt.find(".dfrm_"+e.errFlds[l]).html(e.errMsgs[e.errFlds[l]]),r.$formCnt.find(".dfrm_"+e.errFlds[l]).show();if(void 0!==e.errFldMsgs){r.debug("Going to add error messages");for(var a in e.errFldMsgs){r.debug(" - "+a),r.addErrorClass(a);var i=r.$form.find('[name="'+a+'"]'),d=i.closest(r.options.errorClassSelector).find(".dfrmErrMsgs");if(d.length>0){d.show();for(var l=0;l<e.errFldMsgs[a].length;l++)d.append("<li>"+e.errFldMsgs[a][l]+"</li>")}}}else r.debug("No Error Messages");if(void 0!==e.errFlds&&e.errFlds.length>0){r.debug("Going to add error class to fields by "+r.options.errorClassType);for(var l=0;l<e.errFlds.length;l++)r.addErrorClass(e.errFlds[l])}else r.debug("No Error Fields");var n=o(window).scrollTop();if(1==r.options.scrollTopOnError&&(r.debug("Scrolling to top"),r.scrollTop()),1==r.options.scrollFirstOnError){r.debug("Scrolling to first element with error class ["+r.options.errorClass+"]");var c=r.$formCnt.find("."+r.options.errorClass+":first");c.length>0&&(n>c.offset().top?(r.debug("Scroll to ["+c.offset().top+"]"),o("html, body").animate({scrollTop:c.offset().top-r.options.scrollOffsetOnError},r.options.scrollSpeed)):r.debug("Not going to scroll cause ["+n+"] <= ["+c.offset().top+"]"))}},e.prototype.handleSuccess=function(e){var r=this;o.isFunction(r.options.onSuccess)&&r.options.onSuccess.call(this,e);var t=e.msg?e.msg:r.$sucCnt.html(),s=e.successType?e.successType:r.options.successType;if(s)switch(redirectTo=e.redirect?e.redirect:r.options.redirect?r.options.redirect:!1,s){case"modalRedirect":r.modalMessage({message:t,type:"success",autohide:r.options.modalAutoHide,redirect:redirectTo});break;case"modal":r.modalMessage({message:t,type:"success",autohide:r.options.modalAutoHide});break;case"redirect":r.redirect(redirectTo);break;case"closeModal":parent.TINY.box.hide();break;case"reloadParent":parent.window.location=parent.window.location;break;case"show":r.$sucCnt.html(t).show();break;case"showhide":r.$sucCnt.html(t).show();var a=r.$formCnt.find(".frmSuccessHide");a.length>0?a.hide():r.$form.hide()}1==r.options.scrollTopOnSuccess&&r.scrollTop()},e.prototype.scrollTop=function(){var e=this,r=o(window).scrollTop();r>e.$formCnt.offset().top&&o("html, body").animate({scrollTop:e.$formCnt.offset().top-e.options.scrollOffsetOnError},e.options.scrollSpeed)},e.prototype.modalMessage=function(e){var r=this,t={title:!1,message:"",type:"success",autohide:!1,redirect:!1},e=o.extend(!0,t,e);switch(0==e.title&&(e.title="success"==e.type?"Success":"Error"),r.options.modalType){case"fancybox":o.fancybox?(o.fancybox.open({type:"html",autoHeight:!0,minHeight:50,content:e.message}),e.autohide!==!1&&setTimeout(function(){o.fancybox.close()},e.autohide)):alert("missing fancybox");break;case"tinybox":if(TINY){var s={html:e.message,animate:!1,close:!1,mask:!1,boxid:e.type,autohide:e.autohide/1e3};e.redirect!==!1&&(s.closejs=function(){r.redirect(e.redirect)}),TINY.box.show(s)}else alert("missing tinybox");break;case"jqueryui":o("#dformModalJqueryUI").dialog("destroy"),0==o("#dformModalJqueryUI").length&&o("body").append('<div id="dformModalJqueryUI" title=""><p id="dformModalMessageJqueryUI"></p></div>'),console.log("Title:"+e.title),o("#dformModalJqueryUI").attr("title",e.title),o("#dformModalMessageJqueryUI").html(e.message),o("#dformModalJqueryUI").dialog({buttons:{Close:function(){o(this).dialog("close")}}});break;case"bootbox":bootbox.dialog({message:e.message,title:e.title}),e.autohide!==!1&&setTimeout(function(){bootbox.hideAll(),e.redirect!==!1&&r.redirect(e.redirect)},e.autohide);break;default:0==o("#dformModal").length&&o("body").append('<div class="modal" id="dformModal" role="dialog"aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title" id="dformModalTitle"></h4></div><div class="modal-body"><p id="dformModalMessage"></p></div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div>'),o("#dformModalTitle").html(e.title),o("#dformModalMessage").html(e.message),o("#dformModalTitle").removeClass("text-success").removeClass("text-danger"),"success"==e.type&&o("#dformModalTitle").addClass("text-success"),"error"==e.type&&o("#dformModalTitle").addClass("text-danger"),o("#dformModal").modal({show:!0}),e.autohide!==!1&&setTimeout(function(){o("#dformModal").modal("hide"),e.redirect!==!1&&r.redirect(e.redirect)},e.autohide)}},e.prototype.redirect=function(o){window.location=o},o.fn.dform=function(r,t){var s={debug:!1,bloadOpts:{},beforeSend:{},onBefore:!1,onComplete:!1,onSuccess:!1,onError:!1,errorClassType:"parent",errorClassSelector:"div",errorClass:"has-error",errorFieldMsgClass:"dfrmErrorMsg",scrollTopOnError:!1,scrollOffsetOnError:0,scrollFirstOnError:!1,scrollSpeed:500,scrollTopOnSuccess:!0,fullErrorType:"show",modalType:"bootstrap",modalAutoHide:3e3,successType:"showhide",redirect:!1},r=o.extend(!0,s,r);return this.each(function(){if(o(this).data("dformInit")===!0)var t=o(this).data("dform");else{o(this).data("dformInit",!0);var t=new e;o(this).data("dform",t)}return t.init(o(this),r),t})}}(jQuery);