/*!
 * dform.js v0.4.6
 */
!function(o){var e=function(){};e.prototype.init=function(e,t){var r=this;r.options=t,r.$formCnt=e,r.$form=e.find("form"),r.$subBtn=e.find(".subBtn"),r.$errCnt=e.find(".errorMsg"),r.$sucCnt=e.find(".successMsg"),r.$subBtn.prop("disabled",!1),r.$form.find("input, textarea").each(function(e,t){""==o(this).val()&&o(this).val(o(this).attr("data-default")),o(this).focus(function(){o(this).val()==o(this).attr("data-default")&&o(this).val("")}),o(this).blur(function(){""==o(this).val()&&o(this).val(o(this).attr("data-default"))})}),r.$form.find("."+r.options.errorFieldMsgClass).hide(),r.$subBtn.click(function(e){e.preventDefault(),r.post(o(this))}),r.$form.submit(function(o){o.preventDefault(),r.post(r.$subBtn)})},e.prototype.debug=function(o){1==this.options.debug&&window.console&&console.log(o)},e.prototype.post=function(e){var t=this;o.isFunction(t.options.onBefore)&&t.options.onBefore.call(this),t.$errCnt.hide(),t.$sucCnt.hide(),t.$formCnt.find("."+t.options.errorFieldMsgClass).hide(),t.$subBtn.prop("disabled",!0),t.$form.find("input, textarea").each(function(){o(this).val()==o(this).attr("data-default")&&o(this).val("")}),t.debug("post"),t.$formCnt.bload(t.options.bloadOpts,function(r){t.debug("bload"),t.$formCnt.find('[name="submitted"]').val("yes");var s=t.$form.attr("action");""==s&&(s=document.URL);var a=t.$form.serializeArray();e&&e.attr("name")&&e.attr("value")&&a.push({name:e.attr("name"),value:e.attr("value")}),o.ajax({type:"POST",cache:!1,url:s,data:a,beforeSend:t.options.beforeSend,dataType:"json",success:function(e,r){return t.debug("success"),t.debug(e),o.isFunction(t.options.onComplete)?void t.options.onComplete.call(this,e):(e.modalType&&(t.options.modalType=e.modalType),t.options.errorClass!==!1&&t.$formCnt.find("."+t.options.errorClass).removeClass(t.options.errorClass),"error"==e.status?(t.debug("status error"),t.$form.find("input, textarea").each(function(){""==o(this).val()&&o(this).attr("data-default")&&o(this).val(o(this).attr("data-default"))}),t.handleError(e)):(t.debug("status success"),t.handleSuccess(e)),void 0)},error:function(o,e,r){t.debug("error")},complete:function(o,e){t.debug("complete"),r.hide(),t.$subBtn.prop("disabled",!1)}})})},e.prototype.addErrorClass=function(o){var e=this,t=e.$form.find('[name="'+o+'"]');switch(e.options.errorClassType){case"parent":t.closest(e.options.errorClassSelector).addClass(e.options.errorClass),e.debug("Add Err Class ["+e.options.errorClass+"] to parent div of ["+o+"]");break;case"input":t.addClass(e.options.errorClass),e.debug("Add Err Class ["+e.options.errorClass+"] to input ["+o+"]")}},e.prototype.handleError=function(e){var t=this;if(o.isFunction(t.options.onError)&&t.options.onError.call(this,e),t.options.fullErrorType!==!1){var r=e.msg?e.msg:t.$errCnt.html(),s=e.fullErrorType?e.fullErrorType:t.options.fullErrorType;switch(s){case"modal":t.modalMessage({message:r,type:"error"});break;case"show":t.$errCnt.html(r).show()}}if(e.errFlds&&e.errFlds.length>0)for(l=0;l<e.errFlds.length;l++)e.errMsgs&&e.errMsgs[e.errFlds[l]]&&t.$formCnt.find(".dfrm_"+e.errFlds[l]).html(e.errMsgs[e.errFlds[l]]),t.$formCnt.find(".dfrm_"+e.errFlds[l]).show();if(void 0!==e.errFldMsgs){t.debug("Going to add error messages");for(var a in e.errFldMsgs){t.debug(" - "+a),t.addErrorClass(a);var i=t.$form.find('[name="'+a+'"]'),d=i.closest(t.options.errorClassSelector).find(".dfrmErrMsgs");if(d.length>0){d.show();for(var l=0;l<e.errFldMsgs[a].length;l++)d.append("<li>"+e.errFldMsgs[a][l]+"</li>")}}}else t.debug("No Error Messages");if(void 0!==e.errFlds&&e.errFlds.length>0){t.debug("Going to add error class to fields by "+t.options.errorClassType);for(var l=0;l<e.errFlds.length;l++)t.addErrorClass(e.errFlds[l])}else t.debug("No Error Fields");var n=o(window).scrollTop();if(1==t.options.scrollTopOnError&&(t.debug("Scrolling to top"),t.scrollTop()),1==t.options.scrollFirstOnError){t.debug("Scrolling to first element with error class ["+t.options.errorClass+"]");var c=t.$formCnt.find("."+t.options.errorClass+":first");c.length>0&&(n>c.offset().top?(t.debug("Scroll to ["+c.offset().top+"]"),o("html, body").animate({scrollTop:c.offset().top-t.options.scrollOffsetOnError},t.options.scrollSpeed)):t.debug("Not going to scroll cause ["+n+"] <= ["+c.offset().top+"]"))}},e.prototype.handleSuccess=function(e){var t=this;o.isFunction(t.options.onSuccess)&&t.options.onSuccess.call(this,e);var r=e.msg?e.msg:t.$sucCnt.html(),s=e.successType?e.successType:t.options.successType;if(s)switch(redirectTo=e.redirect?e.redirect:t.options.redirect?t.options.redirect:!1,s){case"modalRedirect":t.modalMessage({message:r,type:"success",autohide:t.options.modalAutoHide,redirect:redirectTo});break;case"modal":t.modalMessage({message:r,type:"success",autohide:t.options.modalAutoHide});break;case"redirect":t.redirect(redirectTo);break;case"closeModal":parent.TINY.box.hide();break;case"reloadParent":parent.window.location=parent.window.location;break;case"show":t.$sucCnt.html(r).show();break;case"showhide":t.$sucCnt.html(r).show();var a=t.$formCnt.find(".frmSuccessHide");a.length>0?a.hide():t.$form.hide()}1==t.options.scrollTopOnSuccess&&t.scrollTop()},e.prototype.scrollTop=function(){var e=this,t=o(window).scrollTop();t>e.$formCnt.offset().top&&o("html, body").animate({scrollTop:e.$formCnt.offset().top-e.options.scrollOffsetOnError},e.options.scrollSpeed)},e.prototype.modalMessage=function(e){var t=this,r={title:!1,message:"",type:"success",autohide:!1,redirect:!1},e=o.extend(!0,r,e);switch(0==e.title&&(e.title="success"==e.type?"Success":"Error"),t.options.modalType){case"fancybox":o.fancybox?(o.fancybox.open({type:"html",autoHeight:!0,minHeight:50,content:e.message}),e.autohide!==!1&&setTimeout(function(){o.fancybox.close()},e.autohide)):alert("missing fancybox");break;case"tinybox":if(TINY){var s={html:e.message,animate:!1,close:!1,mask:!1,boxid:e.type,autohide:e.autohide/1e3};e.redirect!==!1&&(s.closejs=function(){t.redirect(e.redirect)}),TINY.box.show(s)}else alert("missing tinybox");break;case"jqueryui":o("#dformModalJqueryUI").dialog("destroy"),0==o("#dformModalJqueryUI").length&&o("body").append('<div id="dformModalJqueryUI" title=""><p id="dformModalMessageJqueryUI"></p></div>'),console.log("Title:"+e.title),o("#dformModalJqueryUI").attr("title",e.title),o("#dformModalMessageJqueryUI").html(e.message),o("#dformModalJqueryUI").dialog({buttons:{Close:function(){o(this).dialog("close")}}});break;case"bootbox":bootbox.dialog({message:e.message,title:e.title}),e.autohide!==!1&&setTimeout(function(){bootbox.hideAll(),e.redirect!==!1&&t.redirect(e.redirect)},e.autohide);break;default:0==o("#dformModal").length&&o("body").append('<div class="modal" id="dformModal" role="dialog"aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title" id="dformModalTitle"></h4></div><div class="modal-body"><p id="dformModalMessage"></p></div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div>'),o("#dformModalTitle").html(e.title),o("#dformModalMessage").html(e.message),o("#dformModalTitle").removeClass("text-success").removeClass("text-danger"),"success"==e.type&&o("#dformModalTitle").addClass("text-success"),"error"==e.type&&o("#dformModalTitle").addClass("text-danger"),o("#dformModal").modal({show:!0}),e.autohide!==!1&&setTimeout(function(){o("#dformModal").modal("hide"),e.redirect!==!1&&t.redirect(e.redirect)},e.autohide)}},e.prototype.redirect=function(o){window.location=o},o.fn.dform=function(t,r){var s={debug:!1,bloadOpts:{},beforeSend:function(){},onBefore:!1,onComplete:!1,onSuccess:!1,onError:!1,errorClassType:"parent",errorClassSelector:"div",errorClass:"has-error",errorFieldMsgClass:"dfrmErrorMsg",scrollTopOnError:!1,scrollOffsetOnError:0,scrollFirstOnError:!1,scrollSpeed:500,scrollTopOnSuccess:!0,fullErrorType:"show",modalType:"bootstrap",modalAutoHide:3e3,successType:"showhide",redirect:!1},t=o.extend(!0,s,t);return this.each(function(){if(o(this).data("dformInit")===!0)var r=o(this).data("dform");else{o(this).data("dformInit",!0);var r=new e;o(this).data("dform",r)}return r.init(o(this),t),r})}}(jQuery);