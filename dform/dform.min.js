/*!
 * dform.js v0.4.1
 */
!function(e){var o=function(o,t){var s=this;s.options=t,s.$formCnt=o,s.$form=o.find("form"),s.$subBtn=o.find(".subBtn"),s.$errCnt=o.find(".errorMsg"),s.$sucCnt=o.find(".successMsg"),s.$subBtn.prop("disabled",!1),s.$form.find("input, textarea").each(function(){""==e(this).val()&&e(this).val(e(this).attr("data-default")),e(this).focus(function(){e(this).val()==e(this).attr("data-default")&&e(this).val("")}),e(this).blur(function(){""==e(this).val()&&e(this).val(e(this).attr("data-default"))})}),s.$form.find("."+s.options.errorFieldMsgClass).hide(),s.$subBtn.click(function(o){o.preventDefault(),s.post(e(this))}),s.$form.submit(function(e){e.preventDefault(),s.post(s.$subBtn)})};o.prototype.debug=function(e){1==this.options.debug&&"undefined"!=typeof window.console&&console.log(e)},o.prototype.post=function(o){var t=this;e.isFunction(t.options.onBefore)&&t.options.onBefore.call(this),t.$errCnt.hide(),t.$sucCnt.hide(),t.$formCnt.find("."+t.options.errorFieldMsgClass).hide(),t.$subBtn.prop("disabled",!0),t.$form.find("input, textarea").each(function(){e(this).val()==e(this).attr("data-default")&&e(this).val("")}),t.debug("post"),t.$formCnt.bload(t.options.bloadOpts,function(s){t.debug("bload"),t.$formCnt.find('[name="submitted"]').val("yes");var r=t.$form.attr("action");""==r&&(r=document.URL);var i=t.$form.serializeArray();"undefined"!=o&&o.attr("name")&&o.attr("value")&&i.push({name:o.attr("name"),value:o.attr("value")}),e.ajax({type:"POST",cache:!1,url:r,data:i,dataType:"json",success:function(o){return t.debug("success"),t.debug(o),e.isFunction(t.options.onComplete)?void t.options.onComplete.call(this,o):("undefined"!=typeof o.modalType&&(t.options.modalType=o.modalType),t.options.errorClass!==!1&&t.$formCnt.find("."+t.options.errorClass).removeClass(t.options.errorClass),"error"==o.status?(t.debug("status error"),t.$form.find("input, textarea").each(function(){""==e(this).val()&&e(this).attr("data-default")&&e(this).val(e(this).attr("data-default"))}),t.handleError(o)):(t.debug("status success"),t.handleSuccess(o)),void 0)},error:function(){t.debug("error")},complete:function(){t.debug("complete"),s.hide(),t.$subBtn.prop("disabled",!1)}})})},o.prototype.handleError=function(o){var t=this;if(e.isFunction(t.options.onError)&&t.options.onError.call(this,o),t.options.fullErrorType!==!1){var s="undefined"!=typeof o.msg?o.msg:t.$errCnt.html(),r="undefined"!=typeof o.fullErrorType&&""!==o.fullErrorType?o.fullErrorType:t.options.fullErrorType;switch(r){case"modal":t.modalMessage({message:s,type:"error"});break;case"show":t.$errCnt.html(s).show()}}if(o.errFlds&&o.errFlds.length>0)for(i=0;i<o.errFlds.length;i++)o.errMsgs&&o.errMsgs[o.errFlds[i]]&&t.$formCnt.find(".dfrm_"+o.errFlds[i]).html(o.errMsgs[o.errFlds[i]]),t.$formCnt.find(".dfrm_"+o.errFlds[i]).show();if("undefined"!=typeof o.errFlds&&null!=o.errFlds)for(i=0;i<o.errFlds.length;i++){var a=t.$form.find('[name="'+o.errFlds[i]+'"]');switch(t.options.errorClassType){case"parent":a.closest(t.options.errorClassSelector).addClass(t.options.errorClass),t.debug("Add Err Class ["+t.options.errorClass+"] to parent div of ["+o.errFlds[i]+"]");break;case"input":a.addClass(t.options.errorClass),t.debug("Add Err Class ["+t.options.errorClass+"] to input ["+o.errFlds[i]+"]")}}var d=e(window).scrollTop();if(1==t.options.scrollTopOnError&&t.scrollTop(),1==t.options.scrollFirstOnError){var n=t.$formCnt.find("."+t.options.errorClass+":first");n.length>0&&d>n.offset().top&&e("html, body").animate({scrollTop:n.offset().top-t.options.scrollOffsetOnError},t.options.scrollSpeed)}},o.prototype.handleSuccess=function(o){var t=this;e.isFunction(t.options.onSuccess)&&t.options.onSuccess.call(this,o);var s="undefined"!=typeof o.msg&&""!==o.msg?o.msg:t.$sucCnt.html(),r="undefined"!=typeof o.successType&&""!==o.successType?o.successType:t.options.successType;if(r!==!1)switch(redirectTo="undefined"!=typeof o.redirect&&null!=o.redirect?o.redirect:"undefined"!=typeof t.options.redirect?t.options.redirect:!1,r){case"modalRedirect":t.modalMessage({message:s,type:"success",autohide:t.options.modalAutoHide,redirect:redirectTo});break;case"modal":t.modalMessage({message:s,type:"success",autohide:t.options.modalAutoHide});break;case"redirect":t.redirect(redirectTo);break;case"closeModal":parent.TINY.box.hide();break;case"reloadParent":parent.window.location=parent.window.location;break;case"show":t.$sucCnt.html(s).show();break;case"showhide":t.$sucCnt.html(s).show();var i=t.$formCnt.find(".frmSuccessHide");i.length>0?i.hide():t.$form.hide()}1==t.options.scrollTopOnSuccess&&t.scrollTop()},o.prototype.scrollTop=function(){var o=this,t=e(window).scrollTop();t>o.$formCnt.offset().top&&e("html, body").animate({scrollTop:o.$formCnt.offset().top-o.options.scrollOffsetOnError},o.options.scrollSpeed)},o.prototype.modalMessage=function(){var o=this,t={title:!1,message:"",type:"success",autohide:!1,redirect:!1},s=e.extend(!0,t,s);switch(0==s.title&&(s.title="success"==s.type?"Success":"Error"),o.options.modalType){case"fancybox":"undefined"==typeof e.fancybox?alert("missing fancybox"):(e.fancybox.open({type:"html",autoHeight:!0,minHeight:50,content:s.message}),s.autohide!==!1&&setTimeout(function(){e.fancybox.close()},s.autohide));break;case"tinybox":if("undefined"==typeof TINY)alert("missing tinybox");else{var r={html:s.message,animate:!1,close:!1,mask:!1,boxid:s.type,autohide:s.autohide/1e3};s.redirect!==!1&&(r.closejs=function(){o.redirect(s.redirect)}),TINY.box.show(r)}break;case"jqueryui":e("#dformModalJqueryUI").dialog("destroy"),0==e("#dformModalJqueryUI").length&&e("body").append('<div id="dformModalJqueryUI" title=""><p id="dformModalMessageJqueryUI"></p></div>'),console.log("Title:"+s.title),e("#dformModalJqueryUI").attr("title",s.title),e("#dformModalMessageJqueryUI").html(s.message),e("#dformModalJqueryUI").dialog({buttons:{Close:function(){e(this).dialog("close")}}});break;default:0==e("#dformModal").length&&e("body").append('<div class="modal" id="dformModal" role="dialog"aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title" id="dformModalTitle"></h4></div><div class="modal-body"><p id="dformModalMessage"></p></div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div>'),e("#dformModalTitle").html(s.title),e("#dformModalMessage").html(s.message),e("#dformModalTitle").removeClass("text-success").removeClass("text-danger"),"success"==s.type&&e("#dformModalTitle").addClass("text-success"),"error"==s.type&&e("#dformModalTitle").addClass("text-danger"),e("#dformModal").modal({show:!0}),s.autohide!==!1&&setTimeout(function(){e("#dformModal").modal("hide"),s.redirect!==!1&&o.redirect(s.redirect)},s.autohide)}},o.prototype.redirect=function(e){window.location=e},e.fn.dform=function(t){var s={debug:!1,bloadOpts:{},onBefore:!1,onComplete:!1,onSuccess:!1,onError:!1,errorClassType:"parent",errorClassSelector:"div",errorClass:"has-error",errorFieldMsgClass:"dfrmErrorMsg",scrollTopOnError:!1,scrollOffsetOnError:0,scrollFirstOnError:!1,scrollSpeed:500,scrollTopOnSuccess:!0,fullErrorType:"show",modalType:"bootstrap",modalAutoHide:3e3,successType:"showhide",redirect:!1},t=e.extend(!0,s,t);return this.each(function(){if(e(this).data("dformInit")===!0)var s=e(this).data("dform");else{e(this).data("dformInit",!0);var s=new o(e(this),t);e(this).data("dform",s)}return s})}}(jQuery);