/*!
 * dform.js v0.4.7
 */
;function(a){var b=function(){};b.prototype.init=function(b,c){var d=this;d.options=c,d.$formCnt=b,d.$form=b.find("form"),d.$subBtn=b.find(".subBtn"),d.$errCnt=b.find(".errorMsg"),d.$sucCnt=b.find(".successMsg"),d.$subBtn.prop("disabled",!1),d.$form.find("input, textarea").each(function(b,c){""==a(this).val()&&a(this).val(a(this).attr("data-default")),a(this).focus(function(){a(this).val()==a(this).attr("data-default")&&a(this).val("")}),a(this).blur(function(){""==a(this).val()&&a(this).val(a(this).attr("data-default"))})}),d.$form.find("."+d.options.errorFieldMsgClass).hide(),d.$subBtn.click(function(b){b.preventDefault(),d.post(a(this))}),d.$form.submit(function(a){a.preventDefault(),d.post(d.$subBtn)})},b.prototype.debug=function(a){1==this.options.debug&&window.console&&console.log(a)},b.prototype.post=function(b){var c=this;a.isFunction(c.options.onBefore)&&c.options.onBefore.call(this),c.$errCnt.hide(),c.$sucCnt.hide(),c.$formCnt.find("."+c.options.errorFieldMsgClass).hide(),c.$subBtn.prop("disabled",!0),c.$form.find("input, textarea").each(function(){a(this).val()==a(this).attr("data-default")&&a(this).val("")}),c.debug("post"),c.$formCnt.bload(c.options.bloadOpts,function(d){c.debug("bload"),c.$formCnt.find('[name="submitted"]').val("yes");var e=c.$form.attr("action");""==e&&(e=document.URL),!1!==c.options.url&&(e=c.options.url);var f=c.$form.serializeArray();b&&b.attr("name")&&b.attr("value")&&f.push({name:b.attr("name"),value:b.attr("value")});var g=!0===c.options.jsonp?"jsonp":"json";a.ajax({type:"POST",cache:!1,url:e,data:f,beforeSend:c.options.beforeSend,dataType:g,success:function(b,d){return c.debug("success"),c.debug(b),a.isFunction(c.options.onComplete)?void c.options.onComplete.call(this,b):(b.modalType&&(c.options.modalType=b.modalType),c.options.errorClass!==!1&&c.$formCnt.find("."+c.options.errorClass).removeClass(c.options.errorClass),"error"==b.status?(c.debug("status error"),c.$form.find("input, textarea").each(function(){""==a(this).val()&&a(this).attr("data-default")&&a(this).val(a(this).attr("data-default"))}),c.handleError(b)):(c.debug("status success"),c.handleSuccess(b)),void 0)},error:function(a,b,d){c.debug("error")},complete:function(a,b){c.debug("complete"),d.hide(),c.$subBtn.prop("disabled",!1)}})})},b.prototype.addErrorClass=function(a){var b=this,c=b.$form.find('[name="'+a+'"]');switch(b.options.errorClassType){case"parent":c.closest(b.options.errorClassSelector).addClass(b.options.errorClass),b.debug("Add Err Class ["+b.options.errorClass+"] to parent div of ["+a+"]");break;case"input":c.addClass(b.options.errorClass),b.debug("Add Err Class ["+b.options.errorClass+"] to input ["+a+"]")}},b.prototype.handleError=function(b){var c=this;if(a.isFunction(c.options.onError)&&c.options.onError.call(this,b),c.options.fullErrorType!==!1){var d=b.msg?b.msg:c.$errCnt.html(),e=b.fullErrorType?b.fullErrorType:c.options.fullErrorType;switch(e){case"modal":c.modalMessage({message:d,type:"error"});break;case"show":c.$errCnt.html(d).show()}}if(b.errFlds&&b.errFlds.length>0)for(i=0;i<b.errFlds.length;i++)b.errMsgs&&b.errMsgs[b.errFlds[i]]&&c.$formCnt.find(".dfrm_"+b.errFlds[i]).html(b.errMsgs[b.errFlds[i]]),c.$formCnt.find(".dfrm_"+b.errFlds[i]).show();if(void 0!==b.errFldMsgs){c.debug("Going to add error messages");for(var f in b.errFldMsgs){c.debug(" - "+f),c.addErrorClass(f);var g=c.$form.find('[name="'+f+'"]'),h=g.closest(c.options.errorClassSelector).find(".dfrmErrMsgs");if(h.length>0){h.show();for(var i=0;i<b.errFldMsgs[f].length;i++)h.append("<li>"+b.errFldMsgs[f][i]+"</li>")}}}else c.debug("No Error Messages");if(void 0!==b.errFlds&&b.errFlds.length>0){c.debug("Going to add error class to fields by "+c.options.errorClassType);for(var i=0;i<b.errFlds.length;i++)c.addErrorClass(b.errFlds[i])}else c.debug("No Error Fields");var j=a(window).scrollTop();if(1==c.options.scrollTopOnError&&(c.debug("Scrolling to top"),c.scrollTop()),1==c.options.scrollFirstOnError){c.debug("Scrolling to first element with error class ["+c.options.errorClass+"]");var k=c.$formCnt.find("."+c.options.errorClass+":first");k.length>0&&(j>k.offset().top?(c.debug("Scroll to ["+k.offset().top+"]"),a("html, body").animate({scrollTop:k.offset().top-c.options.scrollOffsetOnError},c.options.scrollSpeed)):c.debug("Not going to scroll cause ["+j+"] <= ["+k.offset().top+"]"))}},b.prototype.handleSuccess=function(b){var c=this;a.isFunction(c.options.onSuccess)&&c.options.onSuccess.call(this,b);var d=b.msg?b.msg:c.$sucCnt.html(),e=b.successType?b.successType:c.options.successType;if(e)switch(redirectTo=b.redirect?b.redirect:!!c.options.redirect&&c.options.redirect,e){case"modalRedirect":c.modalMessage({message:d,type:"success",autohide:c.options.modalAutoHide,redirect:redirectTo});break;case"modal":c.modalMessage({message:d,type:"success",autohide:c.options.modalAutoHide});break;case"redirect":c.redirect(redirectTo);break;case"closeModal":parent.TINY.box.hide();break;case"reloadParent":parent.window.location=parent.window.location;break;case"show":c.$sucCnt.html(d).show();break;case"showhide":c.$sucCnt.html(d).show();var f=c.$formCnt.find(".frmSuccessHide");f.length>0?f.hide():c.$form.hide()}1==c.options.scrollTopOnSuccess&&c.scrollTop()},b.prototype.scrollTop=function(){var b=this,c=a(window).scrollTop();c>b.$formCnt.offset().top&&a("html, body").animate({scrollTop:b.$formCnt.offset().top-b.options.scrollOffsetOnError},b.options.scrollSpeed)},b.prototype.modalMessage=function(b){var c=this,d={title:!1,message:"",type:"success",autohide:!1,redirect:!1},b=a.extend(!0,d,b);switch(0==b.title&&(b.title="success"==b.type?"Success":"Error"),c.options.modalType){case"fancybox":a.fancybox?(a.fancybox.open({type:"html",autoHeight:!0,minHeight:50,content:b.message}),b.autohide!==!1&&setTimeout(function(){a.fancybox.close()},b.autohide)):alert("missing fancybox");break;case"tinybox":if(TINY){var e={html:b.message,animate:!1,close:!1,mask:!1,boxid:b.type,autohide:b.autohide/1e3};b.redirect!==!1&&(e.closejs=function(){c.redirect(b.redirect)}),TINY.box.show(e)}else alert("missing tinybox");break;case"jqueryui":a("#dformModalJqueryUI").dialog("destroy"),0==a("#dformModalJqueryUI").length&&a("body").append('<div id="dformModalJqueryUI" title=""><p id="dformModalMessageJqueryUI"></p></div>'),console.log("Title:"+b.title),a("#dformModalJqueryUI").attr("title",b.title),a("#dformModalMessageJqueryUI").html(b.message),a("#dformModalJqueryUI").dialog({buttons:{Close:function(){a(this).dialog("close")}}});break;case"bootbox":bootbox.dialog({message:b.message,title:b.title}),b.autohide!==!1&&setTimeout(function(){bootbox.hideAll(),b.redirect!==!1&&c.redirect(b.redirect)},b.autohide);break;default:0==a("#dformModal").length&&a("body").append('<div class="modal" id="dformModal" role="dialog"aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title" id="dformModalTitle"></h4></div><div class="modal-body"><p id="dformModalMessage"></p></div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div>'),a("#dformModalTitle").html(b.title),a("#dformModalMessage").html(b.message),a("#dformModalTitle").removeClass("text-success").removeClass("text-danger"),"success"==b.type&&a("#dformModalTitle").addClass("text-success"),"error"==b.type&&a("#dformModalTitle").addClass("text-danger"),a("#dformModal").modal({show:!0}),b.autohide!==!1&&setTimeout(function(){a("#dformModal").modal("hide"),b.redirect!==!1&&c.redirect(b.redirect)},b.autohide)}},b.prototype.redirect=function(a){window.location=a},a.fn.dform=function(c,d){var e={debug:!1,bloadOpts:{},beforeSend:function(){},url:!1,jsonp:!1,onBefore:!1,onComplete:!1,onSuccess:!1,onError:!1,errorClassType:"parent",errorClassSelector:"div",errorClass:"has-error",errorFieldMsgClass:"dfrmErrorMsg",scrollTopOnError:!1,scrollOffsetOnError:0,scrollFirstOnError:!1,scrollSpeed:500,scrollTopOnSuccess:!0,fullErrorType:"show",modalType:"bootstrap",modalAutoHide:3e3,successType:"showhide",redirect:!1},c=a.extend(!0,e,c);return this.each(function(){if(a(this).data("dformInit")===!0)var d=a(this).data("dform");else{a(this).data("dformInit",!0);var d=new b;a(this).data("dform",d)}return d.init(a(this),c),d})}}(jQuery);