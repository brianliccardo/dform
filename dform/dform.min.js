/*!
 * dform.js v0.4.3
 */
!function(o){var e=function(){};e.prototype.init=function(e,t){var s=this;s.options=t,s.$formCnt=e,s.$form=e.find("form"),s.$subBtn=e.find(".subBtn"),s.$errCnt=e.find(".errorMsg"),s.$sucCnt=e.find(".successMsg"),s.$subBtn.prop("disabled",!1),s.$form.find("input, textarea").each(function(){""==o(this).val()&&o(this).val(o(this).attr("data-default")),o(this).focus(function(){o(this).val()==o(this).attr("data-default")&&o(this).val("")}),o(this).blur(function(){""==o(this).val()&&o(this).val(o(this).attr("data-default"))})}),s.$form.find("."+s.options.errorFieldMsgClass).hide(),s.$subBtn.click(function(e){e.preventDefault(),s.post(o(this))}),s.$form.submit(function(o){o.preventDefault(),s.post(s.$subBtn)})},e.prototype.debug=function(o){1==this.options.debug&&void 0!==typeof window.console&&console.log(o)},e.prototype.post=function(e){var t=this;o.isFunction(t.options.onBefore)&&t.options.onBefore.call(this),t.$errCnt.hide(),t.$sucCnt.hide(),t.$formCnt.find("."+t.options.errorFieldMsgClass).hide(),t.$subBtn.prop("disabled",!0),t.$form.find("input, textarea").each(function(){o(this).val()==o(this).attr("data-default")&&o(this).val("")}),t.debug("post"),t.$formCnt.bload(t.options.bloadOpts,function(s){t.debug("bload"),t.$formCnt.find('[name="submitted"]').val("yes");var r=t.$form.attr("action");""==r&&(r=document.URL);var i=t.$form.serializeArray();void 0!=e&&e.attr("name")&&e.attr("value")&&i.push({name:e.attr("name"),value:e.attr("value")}),o.ajax({type:"POST",cache:!1,url:r,data:i,dataType:"json",success:function(e){return t.debug("success"),t.debug(e),o.isFunction(t.options.onComplete)?void t.options.onComplete.call(this,e):(void 0!==typeof e.modalType&&(t.options.modalType=e.modalType),t.options.errorClass!==!1&&t.$formCnt.find("."+t.options.errorClass).removeClass(t.options.errorClass),"error"==e.status?(t.debug("status error"),t.$form.find("input, textarea").each(function(){""==o(this).val()&&o(this).attr("data-default")&&o(this).val(o(this).attr("data-default"))}),t.handleError(e)):(t.debug("status success"),t.handleSuccess(e)),void 0)},error:function(){t.debug("error")},complete:function(){t.debug("complete"),s.hide(),t.$subBtn.prop("disabled",!1)}})})},e.prototype.handleError=function(e){var t=this;if(o.isFunction(t.options.onError)&&t.options.onError.call(this,e),t.options.fullErrorType!==!1){var s=void 0!==typeof e.msg?e.msg:t.$errCnt.html(),r=void 0!==typeof e.fullErrorType&&""!==e.fullErrorType?e.fullErrorType:t.options.fullErrorType;switch(r){case"modal":t.modalMessage({message:s,type:"error"});break;case"show":t.$errCnt.html(s).show()}}if(e.errFlds&&e.errFlds.length>0)for(i=0;i<e.errFlds.length;i++)e.errMsgs&&e.errMsgs[e.errFlds[i]]&&t.$formCnt.find(".dfrm_"+e.errFlds[i]).html(e.errMsgs[e.errFlds[i]]),t.$formCnt.find(".dfrm_"+e.errFlds[i]).show();if(void 0!==typeof e.errFlds&&null!=e.errFlds)for(i=0;i<e.errFlds.length;i++){var a=t.$form.find('[name="'+e.errFlds[i]+'"]');switch(t.options.errorClassType){case"parent":a.closest(t.options.errorClassSelector).addClass(t.options.errorClass),t.debug("Add Err Class ["+t.options.errorClass+"] to parent div of ["+e.errFlds[i]+"]");break;case"input":a.addClass(t.options.errorClass),t.debug("Add Err Class ["+t.options.errorClass+"] to input ["+e.errFlds[i]+"]")}}var d=o(window).scrollTop();if(1==t.options.scrollTopOnError&&t.scrollTop(),1==t.options.scrollFirstOnError){var l=t.$formCnt.find("."+t.options.errorClass+":first");l.length>0&&d>l.offset().top&&o("html, body").animate({scrollTop:l.offset().top-t.options.scrollOffsetOnError},t.options.scrollSpeed)}},e.prototype.handleSuccess=function(e){var t=this;o.isFunction(t.options.onSuccess)&&t.options.onSuccess.call(this,e);var s=void 0!==typeof e.msg&&""!==e.msg?e.msg:t.$sucCnt.html(),r=void 0!==typeof e.successType&&""!==e.successType?e.successType:t.options.successType;if(r!==!1)switch(redirectTo=void 0!==typeof e.redirect&&null!=e.redirect?e.redirect:void 0!==typeof t.options.redirect?t.options.redirect:!1,r){case"modalRedirect":t.modalMessage({message:s,type:"success",autohide:t.options.modalAutoHide,redirect:redirectTo});break;case"modal":t.modalMessage({message:s,type:"success",autohide:t.options.modalAutoHide});break;case"redirect":t.redirect(redirectTo);break;case"closeModal":parent.TINY.box.hide();break;case"reloadParent":parent.window.location=parent.window.location;break;case"show":t.$sucCnt.html(s).show();break;case"showhide":t.$sucCnt.html(s).show();var i=t.$formCnt.find(".frmSuccessHide");i.length>0?i.hide():t.$form.hide()}1==t.options.scrollTopOnSuccess&&t.scrollTop()},e.prototype.scrollTop=function(){var e=this,t=o(window).scrollTop();t>e.$formCnt.offset().top&&o("html, body").animate({scrollTop:e.$formCnt.offset().top-e.options.scrollOffsetOnError},e.options.scrollSpeed)},e.prototype.modalMessage=function(e){var t=this,s={title:!1,message:"",type:"success",autohide:!1,redirect:!1},e=o.extend(!0,s,e);switch(0==e.title&&(e.title="success"==e.type?"Success":"Error"),t.options.modalType){case"fancybox":void 0===typeof o.fancybox?alert("missing fancybox"):(o.fancybox.open({type:"html",autoHeight:!0,minHeight:50,content:e.message}),e.autohide!==!1&&setTimeout(function(){o.fancybox.close()},e.autohide));break;case"tinybox":if(void 0===typeof TINY)alert("missing tinybox");else{var r={html:e.message,animate:!1,close:!1,mask:!1,boxid:e.type,autohide:e.autohide/1e3};e.redirect!==!1&&(r.closejs=function(){t.redirect(e.redirect)}),TINY.box.show(r)}break;case"jqueryui":o("#dformModalJqueryUI").dialog("destroy"),0==o("#dformModalJqueryUI").length&&o("body").append('<div id="dformModalJqueryUI" title=""><p id="dformModalMessageJqueryUI"></p></div>'),console.log("Title:"+e.title),o("#dformModalJqueryUI").attr("title",e.title),o("#dformModalMessageJqueryUI").html(e.message),o("#dformModalJqueryUI").dialog({buttons:{Close:function(){o(this).dialog("close")}}});break;case"bootbox":bootbox.dialog({message:e.message,title:e.title}),e.autohide!==!1&&setTimeout(function(){bootbox.hideAll(),e.redirect!==!1&&t.redirect(e.redirect)},e.autohide);break;default:0==o("#dformModal").length&&o("body").append('<div class="modal" id="dformModal" role="dialog"aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title" id="dformModalTitle"></h4></div><div class="modal-body"><p id="dformModalMessage"></p></div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div>'),o("#dformModalTitle").html(e.title),o("#dformModalMessage").html(e.message),o("#dformModalTitle").removeClass("text-success").removeClass("text-danger"),"success"==e.type&&o("#dformModalTitle").addClass("text-success"),"error"==e.type&&o("#dformModalTitle").addClass("text-danger"),o("#dformModal").modal({show:!0}),e.autohide!==!1&&setTimeout(function(){o("#dformModal").modal("hide"),e.redirect!==!1&&t.redirect(e.redirect)},e.autohide)}},e.prototype.redirect=function(o){window.location=o},o.fn.dform=function(t){var s={debug:!1,bloadOpts:{},onBefore:!1,onComplete:!1,onSuccess:!1,onError:!1,errorClassType:"parent",errorClassSelector:"div",errorClass:"has-error",errorFieldMsgClass:"dfrmErrorMsg",scrollTopOnError:!1,scrollOffsetOnError:0,scrollFirstOnError:!1,scrollSpeed:500,scrollTopOnSuccess:!0,fullErrorType:"show",modalType:"bootstrap",modalAutoHide:3e3,successType:"showhide",redirect:!1},t=o.extend(!0,s,t);return this.each(function(){if(o(this).data("dformInit")===!0)var s=o(this).data("dform");else{o(this).data("dformInit",!0);var s=new e;o(this).data("dform",s)}return s.init(o(this),t),s})}}(jQuery);